---
title: "Reproducible Research: Peer Assessment 1"
output: 
  html_document:
    keep_md: true
---


## Loading and preprocessing the data

Load the dataset from the zip file and convert the string dates to R date-time format.  
Also create totals of steps by day and average of steps by interval.

```{r load}
activity <- read.csv(unz(description = "activity.zip", filename = "activity.csv"),
                     stringsAsFactors=FALSE)

activity$date <- strptime(activity$date, format="%Y-%m-%d")

library(plyr)

activityByDay <- ddply(activity, .(date), function(x) sum(x$steps))

colnames(activityByDay)[2] <- "steps"

activityByInterval <- ddply(activity, .(interval), function(x) mean(x$steps, na.rm=TRUE))

colnames(activityByInterval)[2] <- "avgSteps"
```

## What is mean total number of steps taken per day?

Missing values in the dataset are ignored here (as instructed).  Note there is some subtlety as to what this means.

```{r stepsHist}
hist(activityByDay$steps, xlab="Steps per Day",
     main="Histogram of Total Steps Per Day", breaks=25)
```

Mean number of steps per day = `r mean(activityByDay$steps, na.rm=TRUE)`  
Median number of steps per day = `r median(activityByDay$steps, na.rm=TRUE)`  



## What is the average daily activity pattern?

```{r dailyPattern}
plot(activityByInterval$interval, activityByInterval$avgSteps, type="l",
     xlab="Interval", ylab="Average Number of Steps",
     main="Average Number of Steps by Time of Day")
avgStepOrder <- order(activityByInterval$avgSteps, decreasing=TRUE)
```

The maximum average number of steps per day is `r activityByInterval$avgSteps[avgStepOrder][1]` for time interval `r activityByInterval$interval[avgStepOrder][1]`


## Imputing missing values

First check characteristics of missing values.

```{r missing}
M <- sapply(activity, function(x) sum(is.na(x)));  M[M>0]
table(as.factor(as.character(activity[is.na(activity$steps),"date"])))
```

The total number of missing values is `r sum(is.na(activity))`

Because the NAs occur in entire day blocks impute with the average for the interval.   

```{r impute}
# Having trouble getting this to work correctly, so just use brute force (slow!)
activityImp <- activity
for (i in seq(1,nrow(activityImp))) {
  if (is.na(activityImp$steps[i])) {
    activityImp$steps[i] <- activityByInterval[activityByInterval$interval == activityImp$interval[i], "avgSteps"]
  }
}
# Compute daily totals after imputation
activityImpByDay <- ddply(activityImp, .(date), function(x) sum(x$steps))
colnames(activityImpByDay)[2] <- "steps"
hist(activityImpByDay$steps, xlab="Steps per Day",
     main="Histogram of Total Steps Per Day after Imputation", breaks=25)
```

Mean number of steps per day = `r mean(activityImpByDay$steps, na.rm=TRUE)` after imputation.  
Median number of steps per day = `r median(activityImpByDay$steps, na.rm=TRUE)` after imputation.

The mean and median values are similar to those before imputation.  This is not surprising given that the imputation method chosen results in adding 8 days at the average.

## Are there differences in activity patterns between weekdays and weekends?

Create a factor to indicate whether a weekday or a weekend then compare the average number of steps by time.

```{r weekdaysVweekends}
activityImp$weekday <- factor(weekdays(activityImp$date) %in% c('Saturday', 'Sunday'),
                           labels=c("weekday", "weekend"))
activityImpByWdayInterval <- ddply(activityImp, .(weekday, interval),
                                function(x) mean(x$steps))
colnames(activityImpByWdayInterval)[3] <- "avgSteps"
library(lattice)
xyplot(avgSteps ~ interval | weekday, data=activityImpByWdayInterval,
       type="l", layout=c(1,2), xlab="Interval", ylab="Average Number of Steps",
       main="Average Number of Steps by Time of Day")
```

There does appear to be a difference in activity patterns.  On weekdays steps are more concentrated in the morning and evening while on weekends steps are decreased in the early morning and more spread out across the remainder of the day.
